#!/bin/bash

# Check that the script is only run in build/bin
if [ ! -e compile-gwt-components ]; then
echo compile-gwt-components must only be run from build/bin directory
exit
fi

# Parameters
JVMVARS="-Xmx512M"

# Detect platform
PLATFORM=""
if [ -d "/Users" ]
then
    echo "MAC OS"
    PLATFORM="mac"
    # Do not add this command for 10.5
	 if (uname -v | grep -v -q 9.0); then 
	    JVMVARS="$JVMVARS -XstartOnFirstThread"
     fi
else
	PLATFORM="linux"
fi


OUTDIR=../../WebContent/ITMILL/widgetsets
GWTDIR=../gwt/gwt
SRCDIR=../../src
STYLE=OBF

# Clean anything that could be wrong
rm -r $OUTDIR/*
rm -r .gwt-cache

# Build the widgetsets
java $JVMVARS -cp "$SRCDIR:$GWTDIR/gwt-user.jar:$GWTDIR/gwt-dev-$PLATFORM.jar" com.google.gwt.dev.GWTCompiler -out $OUTDIR com.itmill.toolkit.terminal.gwt.DefaultWidgetSet -style $STYLE
java $JVMVARS -cp "$SRCDIR:$GWTDIR/gwt-user.jar:$GWTDIR/gwt-dev-$PLATFORM.jar" com.google.gwt.dev.GWTCompiler -out "../../WebContent/ITMILL/widgetsets" com.itmill.toolkit.demo.colorpicker.gwt.WidgetSet -style $STYLE
java $JVMVARS -cp "$SRCDIR:$GWTDIR/gwt-user.jar:../../lib/reservr/googlemaps_gwt.jar:$GWTDIR/gwt-dev-$PLATFORM.jar" com.google.gwt.dev.GWTCompiler -out "../../WebContent/ITMILL/widgetsets" com.itmill.toolkit.demo.reservation.gwt.WidgetSet -style $STYLE
